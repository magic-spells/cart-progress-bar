!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).CartProgressBar={})}(this,function(t){"use strict";class ProgressBar extends HTMLElement{constructor(){super(),this.#t()}#t(){this.setAttribute("role","progressbar"),this.setAttribute("aria-valuemin","0"),this.setAttribute("aria-valuemax","100"),this.setAttribute("aria-valuenow","0"),this.innerHTML='<div class="progress-bar-fill"></div>'}setPercent(t){const e=Math.max(0,Math.min(100,t));this.style.setProperty("--cart-progress-percent",`${e}%`),this.setAttribute("aria-valuenow",e)}}customElements.define("progress-bar",ProgressBar);class CartProgressBar extends HTMLElement{#e=0;#s=0;#r=0;#i="";#n="";#a=null;#o=null;static get observedAttributes(){return["threshold","current","message-above","message-below"]}constructor(){super(),this.#u()}#u(){this.#e=parseFloat(this.getAttribute("threshold"))||0,this.#s=parseFloat(this.getAttribute("current"))||0,this.#i=this.getAttribute("message-above")||"",this.#n=this.getAttribute("message-below")||""}async connectedCallback(){if(await customElements.whenDefined("progress-bar"),!customElements.get("progress-bar"))throw new Error("<progress-bar> must be registered before <cart-progress-bar> runs");this.#h(),this.#m(),this.#g()}attributeChangedCallback(t,e,s){if(e!==s)switch(t){case"threshold":this.#e=parseFloat(s)||0,this.#m();break;case"current":this.#s=parseFloat(s)||0,this.#m();break;case"message-above":this.#i=s||"",this.#l();break;case"message-below":this.#n=s||"",this.#l()}}#h(){this.#o=this.querySelector("[data-content-cart-progress-message]")||this.querySelector("p[data-content-cart-progress-message]"),this.#a=this.querySelector("progress-bar"),this.#o||!this.#i&&!this.#n||(this.#o=document.createElement("p"),this.#o.setAttribute("data-content-cart-progress-message",""),this.appendChild(this.#o)),this.#a||(customElements.get("progress-bar")?(this.#a=document.createElement("progress-bar"),this.appendChild(this.#a)):customElements.whenDefined("progress-bar").then(()=>{this.#a||(this.#a=document.createElement("progress-bar"),this.appendChild(this.#a),this.#m())}))}#m(){0===this.#e?this.#r=100:this.#r=Math.min(100,this.#s/this.#e*100),this.#a&&this.#a.setPercent(this.#r),this.#l(),this.#c()}#g(){const t=this.closest("cart-dialog");t&&t.addEventListener("cart-dialog:data-changed",t=>{this.#p(t)})}#p(t){const e=t.detail;if(e){let t=0;void 0!==e.calculated_subtotal?t=e.calculated_subtotal/100:void 0!==e.total_price&&(t=e.total_price/100),this.setCurrentAmount(t)}}#l(){const t=this.#s>=this.#e,e=Math.max(0,this.#e-this.#s),s=this.#d(e);if(this.#o){let e;if(t&&this.#i?e=this.#i:t||(e=this.#n||this.#i),e){const t=e.replace("{ amount }",s);this.#o.textContent=t,this.#o.style.display="block"}else this.#o.style.display="none"}}#c(){const t=this.#s>=this.#e;this.setAttribute("complete",t.toString())}#d(t){return new Intl.NumberFormat("en-US",{style:"currency",currency:"USD",minimumFractionDigits:2,maximumFractionDigits:2}).format(t).replace(".00","")}setPercent(t){const e=Math.max(0,Math.min(100,t));this.#r=e,this.#a&&this.#a.setPercent(e),this.#s=e/100*this.#e,this.setAttribute("current",this.#s.toString()),this.#l(),this.#c()}setCurrentAmount(t){this.#s=parseFloat(t)||0,this.setAttribute("current",this.#s.toString()),this.#m()}setThresholdAmount(t){this.#e=parseFloat(t)||0,this.setAttribute("threshold",this.#e.toString()),this.#m()}setMinAmount(t){this.setThresholdAmount(t)}getProgress(){return{currentAmount:this.#s,thresholdAmount:this.#e,minAmount:this.#e,remainingAmount:Math.max(0,this.#e-this.#s),percent:this.#r,isComplete:this.#s>=this.#e}}setMessages(t=null,e=null){null!==t&&(this.#i=t,this.setAttribute("message-above",t)),null!==e&&(this.#n=e,this.setAttribute("message-below",e)),this.#l()}get currentAmount(){return this.#s}get thresholdAmount(){return this.#e}get minAmount(){return this.#e}get percent(){return this.#r}get isComplete(){return this.#s>=this.#e}}customElements.define("cart-progress-bar",CartProgressBar),t.CartProgressBar=CartProgressBar,t.ProgressBar=ProgressBar});
